<!DOCTYPE html> <html lang="ko"> <head> <meta charset="euc-kr"/> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/> <meta name="twitter:title" content="앤서블&라라독"/> <meta name="twitter:description" content="vagrant와 앤서블(Ansible)을 이용하여 만든 가상 머신(guest system)에 라라독(Laradock)을 이용하여 라라벨(Laravel) 개발 환경을 구성해봅시다."/> <meta name="twitter:card" content="summary_large_image"/> <meta name="twitter:site" content="@DevYakuza"/> <meta name="twitter:creator" content="@DevYakuza"/> <title>앤서블&라라독 - vagrant와 앤서블(Ansible)을 이용하여 만든 가상 머신(guest system)에 라라독(Laradock)을 이용하여 라라벨(Laravel) 개발 환경을 구성해봅시다.</title> <meta name="description" content="vagrant와 앤서블(Ansible)을 이용하여 만든 가상 머신(guest system)에 라라독(Laradock)을 이용하여 라라벨(Laravel) 개발 환경을 구성해봅시다."/> <meta property="og:url" content="https://dev-yakuza.github.io/ko/environment/ansible-laradock/"/> <meta name="generator" content="Jekyll v3.8.5"/> <meta property="og:title" content="앤서블&amp;라라독"/> <meta name="author" content="dev.yakuza@gmail.com"/> <meta property="og:locale" content="ko"/> <meta name="description" content="vagrant와 앤서블(Ansible)을 이용하여 만든 가상 머신(guest system)에 라라독(Laradock)을 이용하여 라라벨(Laravel) 개발 환경을 구성해봅시다."/> <meta property="og:description" content="vagrant와 앤서블(Ansible)을 이용하여 만든 가상 머신(guest system)에 라라독(Laradock)을 이용하여 라라벨(Laravel) 개발 환경을 구성해봅시다."/> <link rel="canonical" href="https://dev-yakuza.github.io/ko/environment/ansible-laradock/"/> <meta property="og:url" content="https://dev-yakuza.github.io/environment/ansible-laradock/"/> <meta property="og:site_name" content="Dreams the art through programming"/> <meta property="og:image" content="https://dev-yakuza.github.io/assets/images/category/environment/ansible-laradock.jpg"/> <meta property="og:type" content="article"/> <meta property="article:published_time" content="2018-12-05T00:00:00+09:00"/> <script type="application/ld+json">
{"description":"vagrant와 앤서블(Ansible)을 이용하여 만든 가상 머신(guest system)에 라라독(Laradock)을 이용하여 라라벨(Laravel) 개발 환경을 구성해봅시다.","author":{"@type":"Person","name":"dev.yakuza@gmail.com"},"@type":"BlogPosting","url":"https://dev-yakuza.github.io/environment/ansible-laradock/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://dev-yakuza.github.io/assets/images/icon.png"},"name":"dev.yakuza@gmail.com"},"image":"https://dev-yakuza.github.io/assets/images/category/environment/ansible-laradock.jpg","headline":"앤서블&amp;라라독","dateModified":"2019-05-23T10:57:06+09:00","datePublished":"2018-12-05T00:00:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://dev-yakuza.github.io/environment/ansible-laradock/"},"@context":"http://schema.org"}</script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-125408913-1"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-125408913-1");</script> <link href="https://fonts.googleapis.com/css?family=Noto+Sans+KR" rel="stylesheet"/> <link rel="stylesheet" href="/ko/assets/vendor/bootstrap/css/bootstrap.min.css"/> <link rel="stylesheet" href="/ko/assets/vendor/font-awesome/css/font-awesome.min.css"/> <link rel="stylesheet" href="/ko/assets/main.css?v=20191003"/> <link rel="alternate" type="application/rss+xml" title="Dreams the art through programming" href="/ko/feed.xml"/> <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "dev.yakuza",
      "url": "https://dev-yakuza.github.io",
      "sameAs": [
        "https://www.facebook.com/yakuza.dev.54",
        "https://www.instagram.com/dev_yakuza/",
        "https://twitter.com/DevYakuza"
      ]
    }
  </script> <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "url": "https://dev-yakuza.github.io",
      "logo": "https://dev-yakuza.github.io/assets/images/icon.png"
    }
  </script><script type="application/ld+json">
    {
      "@context":"http://schema.org",
      "@type":"ItemList",
      "itemListElement":[{
          "@type":"ListItem",
          "position":1,"url": "https://dev-yakuza.github.io/ko/environment/vagrant-install-and-usage/"},{
          "@type":"ListItem",
          "position":2,"url": "https://dev-yakuza.github.io/ko/environment/install-ansible/"},{
          "@type":"ListItem",
          "position":3,"url": "https://dev-yakuza.github.io/ko/environment/ansible-playbook/"},{
          "@type":"ListItem",
          "position":4,"url": "https://dev-yakuza.github.io/ko/environment/ansible-docker/"},{
          "@type":"ListItem",
          "position":5,"url": "https://dev-yakuza.github.io/ko/environment/ansible-laradock/"},{
          "@type":"ListItem",
          "position":6,"url": "https://dev-yakuza.github.io/ko/environment/ansible-laravel/"},{
          "@type":"ListItem",
          "position":7,"url": "https://dev-yakuza.github.io/ko/environment/ngrok/"},{
          "@type":"ListItem",
          "position":8,"url": "https://dev-yakuza.github.io/ko/environment/mac-iterm-zsh/"},{
          "@type":"ListItem",
          "position":9,"url": "https://dev-yakuza.github.io/ko/environment/mac-development-tools/"},{
          "@type":"ListItem",
          "position":10,"url": "https://dev-yakuza.github.io/ko/environment/mac-development-environment/"}]
    }
  </script><link rel="stylesheet" href="/ko/assets/highlight/railscasts.css"/> <script src="/assets/highlight/highlight.pack.js"></script> <script>hljs.initHighlightingOnLoad();</script> </head> <body> <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav"> <div class="container"> <a class="navbar-brand" href="/ko/"> <img src="/assets/images/icon.png" alt="dev.yakuza blog logo"/> ヤクザ </a> <div class="navbar-menu-container"> <div class="collapse navbar-collapse"> <ul class="navbar-nav ml-auto"> <li class="nav-item"> <a class="nav-link" href="/ko/">Home</a> </li> <li class="nav-item dropdown"> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> Category </a> <div class="dropdown-menu" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/ko/ildangongbu/">일단공부</a> <a class="dropdown-item" href="/ko/laravel/">Laravel</a> <a class="dropdown-item" href="/ko/books/">책 집필</a> <a class="dropdown-item" href="/ko/blaboo/">BlaBoo</a> <a class="dropdown-item" href="/ko/environment/">개발 환경</a> <a class="dropdown-item" href="/ko/react-native/">React Native</a> <a class="dropdown-item" href="/ko/react/">React</a> <a class="dropdown-item" href="/ko/kumoncho/">kumoncho</a> <a class="dropdown-item" href="/ko/django/">장고(djanog)</a> <a class="dropdown-item" href="/ko/git/">git</a> <a class="dropdown-item" href="/ko/jekyll/">jekyll blog</a> </div> </li> <li class="nav-item"> <a class="nav-link" target="_blank" rel="noopener" href=" /app/list/ko/">Apps</a> </li> <li class="nav-item"> <a class="nav-link" href="/ko/contact/">Contact</a> </li> </ul> </div> <div class="btn-group-sm btn-translate-group dropdown"> <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="fa fa-language" aria-hidden="true"></i> </button> <div class="dropdown-menu"> <a class="dropdown-item menu-ko" href="/ko/environment/ansible-laradock/">한국어</a> <a class="dropdown-item menu-en" href="/en/environment/ansible-laradock/">English</a> <a class="dropdown-item menu-ja" href="/ko/environment/ansible-laradock/">日本語</a> </div> </div> <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"> Menu <i class="fa fa-bars"></i> </button> </div> <div class="collapse navbar-collapse" id="navbarResponsive"> <ul class="navbar-nav ml-auto"> <li class="nav-item"> <a class="nav-link" href="/ko/">Home</a> </li> <li class="nav-item dropdown"> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> Category </a> <div class="dropdown-menu" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/ko/ildangongbu/">일단공부</a> <a class="dropdown-item" href="/ko/laravel/">Laravel</a> <a class="dropdown-item" href="/ko/books/">책 집필</a> <a class="dropdown-item" href="/ko/blaboo/">BlaBoo</a> <a class="dropdown-item" href="/ko/environment/">개발 환경</a> <a class="dropdown-item" href="/ko/react-native/">React Native</a> <a class="dropdown-item" href="/ko/react/">React</a> <a class="dropdown-item" href="/ko/kumoncho/">kumoncho</a> <a class="dropdown-item" href="/ko/django/">장고(djanog)</a> <a class="dropdown-item" href="/ko/git/">git</a> <a class="dropdown-item" href="/ko/jekyll/">jekyll blog</a> </div> </li> <li class="nav-item"> <a class="nav-link" target="_blank" rel="noopener" href=" /app/list/ko/">Apps</a> </li> <li class="nav-item"> <a class="nav-link" href="/ko/contact/">Contact</a> </li> </ul> </div> </div> </nav> <script>document.addEventListener("DOMContentLoaded",function(){var e=window.location.pathname;e.indexOf("/en/")>=0?($(".menu-ko").prop("href",e.replace("/en/","/ko/")),$(".menu-en").prop("href",e),$(".menu-ja").prop("href",e.replace("/en/","/"))):e.indexOf("/ko/")>=0?($(".menu-ko").prop("href",e),$(".menu-en").prop("href",e.replace("/ko/","/en/")),$(".menu-ja").prop("href",e.replace("/ko/","/"))):($(".menu-ko").prop("href","/ko"+e),$(".menu-en").prop("href","/en"+e),$(".menu-ja").prop("href",e)),$("body").on("show.bs.dropdown",".dropdown",function(){$(this).find(".dropdown-menu").first().stop(!0,!0).slideDown()}),$("body").on("hide.bs.dropdown",".dropdown",function(){$(this).find(".dropdown-menu").first().stop(!0,!0).slideUp()})});</script> <header class="masthead" style="background-image: url('/assets/images/category/environment/ansible-laradock.jpg')"> <div class="overlay"></div> <div class="container"> <div class="row"> <div class="col-lg-8 col-md-10 mx-auto"> <div class="post-heading"> <h1>앤서블&라라독</h1> <div class="heading-date"> <i class="fa fa-calendar" aria-hidden="true"></i> 2019-05-23 </div> <h2 class="subheading">vagrant와 앤서블(Ansible)을 이용하여 만든 가상 머신(guest system)에 라라독(Laradock)을 이용하여 라라벨(Laravel) 개발 환경을 구성해봅시다.</h2> </div> </div> </div> </div> </header> <div class="top-ads"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7987914246691031" data-ad-slot="3850742490" data-ad-format="auto" data-full-width-responsive="true"></ins> <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script> </div> <div class="container"> <div class="row"> <div class="col-lg-8 col-md-10 mx-auto"> <nav aria-label="breadcrumb"> <ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList"> <li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"> <a itemtype="http://schema.org/Thing" itemprop="item" href="https://dev-yakuza.github.io"> <span itemprop="name">Home</span> </a> <meta itemprop="position" content="1"/> </li> <li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"> <a itemtype="http://schema.org/Thing" itemprop="item" href="https://dev-yakuza.github.io/ko/environment"> <span itemprop="name">environment</span> </a> <meta itemprop="position" content="2"/> </li> <li class="breadcrumb-item active" aria-current="page" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"> <a itemtype="http://schema.org/Thing" itemprop="item" href="https://dev-yakuza.github.io/ko/environment/ansible-laradock/"> <span itemprop="name">앤서블&라라독</span> </a> <meta itemprop="position" content="3"/> </li> </ol> </nav> </div> </div> <div class="row"> <div class="col-lg-2 col-md-1 d-none d-lg-block left-ads"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:inline-block;width:120px;height:600px" data-ad-client="ca-pub-7987914246691031" data-ad-slot="1333703444"></ins> <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script> </div> <article class="col-lg-8 col-md-10 mx-auto"> <h2 id="개요">개요</h2> <p>요즘 세상은 정말 없는게 없는거 같습니다. 우리가 생각하는 것들은 이미 세상 어딘가에 존재하고 공유되고 있네요. 라라독(Laradock)은 라라벨(Laravel)의 개발 환경에 필요한 요소들을 도커(Docker)로 만들고 관리하는 프로젝트입니다. 자세한 내용은 공식 사이트를 참고해주세요(<a href="https://github.com/laradock/laradock/" rel="nofollow noreferrer" target="_blank">https://github.com/laradock/laradock/</a>). 이 블로그에서는 라라독(Laradock)을 이용하여 라라벨(laravel) 개발 환경을 구성하는 방법에 대해서 설명하겠습니다.</p> <p>이 블로그는 아래에 있는 블로그에 연재물입니다. 이해를 돕기 위해 아래에 블로그 리스트를 먼저 진행하시는걸 추천합니다.</p> <ul> <li><a href="https://dev-yakuza.github.io/ko/environment/vagrant-install-and-usage/" target="_blank">vagrant 설치 및 사용법</a></li> <li><a href="https://dev-yakuza.github.io/ko/environment/install-ansible/" target="_blank">앤서블 설치</a></li> <li><a href="https://dev-yakuza.github.io/ko/environment/ansible-playbook/" target="_blank">앤서블 플레이북</a></li> <li><a href="https://dev-yakuza.github.io/ko/environment/ansible-docker/" target="_blank">앤서블&amp;도커</a></li> </ul> <h2 id="개발-환경-구성">개발 환경 구성</h2> <p>라라독(Laradock)은 개발 환경을 구성하기 위해 다양한 도커(Docker)를 제공합니다. 따라서 자신이 개발하고자 하는 환경에 맞는 도커(Docker)를 선택하고 설치해야합니다. 우리는 아래에 항목으로 개발 환경을 구성할 예정입니다.</p> <ul> <li>nginx</li> <li>mysql</li> <li>phpmyadmin</li> <li>workspace</li> </ul> <div class="in-feed-ads"> <script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-7987914246691031" data-ad-slot="2718813593"></ins> <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script> </div> <h2 id="가상-머신-설정-수정">가상 머신 설정 수정</h2> <p>가상 머신(guest system) 설정을 수정하기 위해 아래와 같이 <code class="highlighter-rouge">Vagrantfile</code>을 수정합니다.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># -*- mode: ruby -*-</span>
<span class="c1"># vi: set ft=ruby :</span>

<span class="no">Vagrant</span><span class="p">.</span><span class="nf">configure</span><span class="p">(</span><span class="s2">"2"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="o">...</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="ss">:virtualbox</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
    <span class="n">vb</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"laravel-dev"</span>
  <span class="k">end</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"forwarded_port"</span><span class="p">,</span> <span class="ss">guest: </span><span class="mi">80</span><span class="p">,</span> <span class="ss">host: </span><span class="mi">80</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"forwarded_port"</span><span class="p">,</span> <span class="ss">guest: </span><span class="mi">8080</span><span class="p">,</span> <span class="ss">host: </span><span class="mi">8080</span>
  <span class="o">...</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">trigger</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:up</span> <span class="k">do</span> <span class="o">|</span><span class="n">trigger</span><span class="o">|</span>
    <span class="n">trigger</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"trigger Docker after Vagrant Up"</span>
    <span class="n">trigger</span><span class="p">.</span><span class="nf">run_remote</span> <span class="o">=</span> <span class="p">{</span><span class="ss">inline: </span><span class="s2">"sudo ansible-playbook /vagrant/ansible/playbook.yml --tags 'docker'"</span><span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>가상 머신(guest system)에 virtualbox에서 표시되는 이름을 <code class="highlighter-rouge">vb.name</code>을 사용하여 특정한 이름(<code class="highlighter-rouge">laravel-dev</code>)를 부여했습니다. 이 부분은 실제 개발 환경 구성과는 무관하며 단지 virtualbox에 표시되는 이름을 알기 쉽게 하기 위함입니다.</p> <p>vagrant의 <code class="highlighter-rouge">config.vm.network "forwarded_port"</code>을 사용하여 로컬 머신(host system)의 포트를 가상 머신(guest system)의 포트로 포트포워드(port-forward)시켰습니다. 이제 로컬 머신(host system)의 포트를 통해 가상 머신(guest system)의 포트에 접근할 수 있습니다. 80 포트는 라라벨(Laravel) 프로젝트를 위해, 8080은 phpmyadmin에 접근하기 위해 연결하였습니다.</p> <p>가상 머신(guest system)을 vagrant 명령어(<code class="highlighter-rouge">vagrant halt</code>)로 중지 시키고 다시 vagrant 명령어(<code class="highlighter-rouge">vagrant up</code>)으로 가상 머신(guest system)을 재시작 했을때, 이전 앤서블 플레이북(Ansible Playbook) 실행 스크립트는 프로비전 쉘(provision shell)에 있으므로 실행되지 않습니다. 또한 라라독(Laradock)의 도커(Docker)들은 항상 재시작(restart always)이 설정되어 있지 않아 가상 머신(guest system)이 재시작할시 도커(Docker)가 기동되지 않습니다. 그래서 우리는 Vagrantfile에 아래와 같이 추가하였습니다.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">config</span><span class="p">.</span><span class="nf">trigger</span><span class="p">.</span><span class="nf">after</span> <span class="ss">:up</span> <span class="k">do</span> <span class="o">|</span><span class="n">trigger</span><span class="o">|</span>
  <span class="n">trigger</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"trigger Docker after Vagrant Up"</span>
  <span class="n">trigger</span><span class="p">.</span><span class="nf">run_remote</span> <span class="o">=</span> <span class="p">{</span><span class="ss">inline: </span><span class="s2">"sudo ansible-playbook /vagrant/ansible/playbook.yml --tags 'docker'"</span><span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div> <p>이 설정은 우리가 <code class="highlighter-rouge">vagrant up</code> 명령어로 가상 머신(guest system)을 시작한 후, 실행될 내용을 정의합니다. 이곳에 가상 머신(guest system)에서 앤서블 플레이북(Ansible Playbook)을 실행하도록 설정하였습니다. 앤서블 플레이북(Ansible Playbook) 명령어가 프로비전 쉘(provision shell)에 있는 명령어와 다르게 <code class="highlighter-rouge">--tags 'docker'</code> 옵션을 사용하고 있습니다. 이 옵션을 사용하면 <code class="highlighter-rouge">docker</code>로 태그(tag)된 명령어만 실행이 됩니다. 자세한 내용은 아래에 앤서블 플레이북(Ansible Playbook) 설정에서 다시 설명하도록 하겠습니다.</p> <h2 id="앤서블-플레이북에-라라독-설정">앤서블 플레이북에 라라독 설정</h2> <p>지난 시간에 이어 앤서블 플레이북(Ansible Playbook)을 사용하여 개발 환경 구성을 진행하겠습니다. 지금까지 구성한 폴더 구조는 아래와 같습니다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>|-- ansible
|    |-- init
|    |    |-- tasks
|    |    |    |-- main.yml
|    |-- docker
|    |    |-- tasks
|    |    |    |-- main.yml
|    |-- playbook.yml
|-- Vagrantfile
</code></pre></div></div> <p>여기에 라라독(Laradock)을 위한 <code class="highlighter-rouge">role</code>을 정의하기 위해 아래와 같이 <code class="highlighter-rouge">laradock/tasks/main.yml</code> 파일을 추가합니다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>|-- ansible
|    |-- init
|    |    |-- tasks
|    |    |    |-- main.yml
|    |-- docker
|    |    |-- tasks
|    |    |    |-- main.yml
|    |-- laradock
|    |    |-- tasks
|    |    |    |-- main.yml
|    |-- playbook.yml
|-- Vagrantfile
</code></pre></div></div> <p>앤서블 플레이북(Ansible Playbook)의 시작점인 <code class="highlighter-rouge">playbook.yml</code> 파일을 열고 라라독(Laradock) <code class="highlighter-rouge">role</code>을 추가합니다.</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="pi">-</span> <span class="na">hosts</span><span class="pi">:</span> <span class="s">localhost</span>
  <span class="na">connection</span><span class="pi">:</span> <span class="s">local</span>
  <span class="na">roles</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">init</span>
    <span class="pi">-</span> <span class="s">docker</span>
    <span class="pi">-</span> <span class="s">laradock</span>
</code></pre></div></div> <p>추가한 <code class="highlighter-rouge">laradock/tasks/main.yml</code> 파일을 아래와 같이 수정합니다.</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">git clone Laradock</span>
  <span class="na">git</span><span class="pi">:</span> <span class="s">repo=https://github.com/Laradock/laradock.git dest=/vagrant/app/laradock/ version=master</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">copy Laradock environment file</span>
  <span class="na">copy</span><span class="pi">:</span> <span class="s">src=/vagrant/app/laradock/env-example dest=/vagrant/app/laradock/.env</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">change mysql version</span>
  <span class="na">replace</span><span class="pi">:</span>
    <span class="na">path</span><span class="pi">:</span> <span class="s">/vagrant/app/laradock/.env</span>
    <span class="na">regexp</span><span class="pi">:</span> <span class="s1">'</span><span class="s">MYSQL_VERSION=*.*'</span>
    <span class="na">replace</span><span class="pi">:</span> <span class="s1">'</span><span class="s">MYSQL_VERSION=5.7'</span>
  <span class="na">tags</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">replace</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">change project folder</span>
  <span class="na">replace</span><span class="pi">:</span>
    <span class="na">path</span><span class="pi">:</span> <span class="s">/vagrant/lib/laradock/.env</span>
    <span class="na">regexp</span><span class="pi">:</span> <span class="s1">'</span><span class="s">APP_CODE_PATH_HOST=*.*'</span>
    <span class="na">replace</span><span class="pi">:</span> <span class="s1">'</span><span class="s">APP_CODE_PATH_HOST=/vagrant/app'</span>
  <span class="na">tags</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">replace</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">dokcer compose Laradock(nginx, mysql, phpmyadmin, workspace)</span>
  <span class="na">docker_service</span><span class="pi">:</span>
    <span class="na">state</span><span class="pi">:</span> <span class="s">present</span>
    <span class="na">project_src</span><span class="pi">:</span> <span class="s">/vagrant/app/laradock</span>
    <span class="na">services</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">nginx</span>
        <span class="pi">-</span> <span class="s">mysql</span>
        <span class="pi">-</span> <span class="s">phpmyadmin</span>
        <span class="pi">-</span> <span class="s">workspace</span>
  <span class="na">tags</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">docker</span>
</code></pre></div></div> <p>추가한 앤서블 플레이북(Ansible Playbook)의 <code class="highlighter-rouge">role</code>을 살펴보겠습니다.</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">git clone Laradock</span>
  <span class="na">git</span><span class="pi">:</span> <span class="s">repo=https://github.com/Laradock/laradock.git dest=/vagrant/app/laradock/ version=master</span>
</code></pre></div></div> <p>앤서블(Ansible)의 git 모듈을 사용하여 라라독(Laradock)의 저장소(repository)를 복사(clone)합니다.</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">copy Laradock environment file</span>
  <span class="na">copy</span><span class="pi">:</span> <span class="s">src=/vagrant/app/laradock/env-example dest=/vagrant/app/laradock/.env</span>
</code></pre></div></div> <p>라라독(Laradock)의 예제 설정 파일(<code class="highlighter-rouge">env-example</code>)을 사용 가능한 설정 파일(<code class="highlighter-rouge">.env</code>)로 복사합니다.</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">change mysql version</span>
  <span class="na">replace</span><span class="pi">:</span>
    <span class="na">path</span><span class="pi">:</span> <span class="s">/vagrant/app/laradock/.env</span>
    <span class="na">regexp</span><span class="pi">:</span> <span class="s1">'</span><span class="s">MYSQL_VERSION=*.*'</span>
    <span class="na">replace</span><span class="pi">:</span> <span class="s1">'</span><span class="s">MYSQL_VERSION=5.7'</span>
  <span class="na">tags</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">replace</span>
</code></pre></div></div> <p>라라독(Laradock)의 환경 파일인 <code class="highlighter-rouge">.env</code>에서 <code class="highlighter-rouge">mysql</code> 버전을 <code class="highlighter-rouge">5.7</code>로 변경합니다. 최신 버전(<code class="highlighter-rouge">8.0</code>)을 사용할 경우 라라벨(Laravel)에서 mysql에 접근시 아래와 같은 에러가 나옵니다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>PDOException]
SQLSTATE[HY000] <span class="o">[</span>2054] The server requested authentication method unknown to the client
</code></pre></div></div> <p>최신 mysql의 암호 인증 방식이 라라벨(Laravel)에서 지원이 안되는 문제가 있어 발생하는거 같습니다. 여러 해결책들이 있지만 mysql 8.0 기능을 딱히 쓰지 않는다면 5.7로 다운그레이드(Downgrade)하여 사용하시길 권장합니다.</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">change project folder</span>
  <span class="na">replace</span><span class="pi">:</span>
    <span class="na">path</span><span class="pi">:</span> <span class="s">/vagrant/lib/laradock/.env</span>
    <span class="na">regexp</span><span class="pi">:</span> <span class="s1">'</span><span class="s">APP_CODE_PATH_HOST=*.*'</span>
    <span class="na">replace</span><span class="pi">:</span> <span class="s1">'</span><span class="s">APP_CODE_PATH_HOST=/vagrant/app'</span>
  <span class="na">tags</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">replace</span>
</code></pre></div></div> <p>라라독(Laradock)의 workspace 도커(Docker)는 우리가 만들 라라벨(Laravel) 프로젝트가 돌아갈 환경입니다. 이 도커(Docker)는 <code class="highlighter-rouge">APP_CODE_PATH_HOST</code>를 참고하여 도커(Docker)를 빌드 및 기동시 해당 폴더를 동기화(sync)하여 라라벨(Laravel) 프로젝트를 기동시킵니다. 기본 설정은 <code class="highlighter-rouge">APP_CODE_PATH_HOST=../</code>으로 라라독(Laradock)의 상위 폴더를 지칭하고 있습니다. 이 부분을 우리는 <code class="highlighter-rouge">/vagrant/app</code> 부분으로 변경하였습니다. 여러분은 여러분의 라라벨(Laravel) 프로젝트의 폴더의 위치로 변경하거나 여러분의 라라벨(Laravel) 프로젝트의 폴더명을 app으로 변경하여 사용하시면 됩니다.</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">dokcer compose Laradock(nginx, mysql, phpmyadmin, workspace)</span>
  <span class="na">docker_service</span><span class="pi">:</span>
    <span class="na">debug</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">state</span><span class="pi">:</span> <span class="s">present</span>
    <span class="na">restarted</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">project_src</span><span class="pi">:</span> <span class="s">/vagrant/app/laradock</span>
    <span class="na">services</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">nginx</span>
        <span class="pi">-</span> <span class="s">mysql</span>
        <span class="pi">-</span> <span class="s">phpmyadmin</span>
        <span class="pi">-</span> <span class="s">workspace</span>
  <span class="na">tags</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">docker</span>
</code></pre></div></div> <p>앤서블(Ansible)의 도커 서비스(Docker Service) 모듈을 사용하여 우리가 필요한 도커(Docker)를 빌드하고 실행시킵니다. 또한 다른 명령어들과는 다르게 <code class="highlighter-rouge">tag</code> 기능을 사용하고 있습니다. 앤서블 플레이북(Ansible Playbook)을 실행할때 <code class="highlighter-rouge">--tags</code> 옵션을 사용하여 태그(tag)된 명령어중 실행하고 싶은 명령어들만을 실행할 수 있습니다. <code class="highlighter-rouge">--tags</code> 옵션이 설정이 되지 않은 상태에서 앤서블 플레이북(Ansible Playbook) 명령어를 실행한다면 모든 명령어들이 전부 실행됩니다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 모든 명령어 실행</span>
<span class="nb">sudo </span>ansible-playbook /vagrant/ansible/playbook.yml
<span class="c"># docker로 태그(tag)된 명령어만 실행</span>
<span class="nb">sudo </span>ansible-playbook /vagrant/ansible/playbook.yml <span class="nt">--tags</span> <span class="s1">'docker'</span>
</code></pre></div></div> <div class="in-feed-ads"> <script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-7987914246691031" data-ad-slot="2718813593"></ins> <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script> </div> <h2 id="앤서블-플레이북-실행">앤서블 플레이북 실행</h2> <p>앤서블 플레이북(Ansible Playbook)에 라라독(Laradock)의 <code class="highlighter-rouge">role</code> 설정이 끝났습니다. 이제 앤서블 플레이북(Ansible Playbook)을 실행하여 라라독(Laradock)을 설치해 봅시다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># vagrant ssh</span>
<span class="nb">sudo </span>ansible-playbook /vagrant/ansible/playbook.yml
</code></pre></div></div> <h2 id="라라독-설치-확인">라라독 설치 확인</h2> <p>앤서블 플레이북(Ansible Playbook)에 의해 라라독(Laradock)이 잘 설치되었는지 아래에 도커(Docker) 명령어를 통해 확인합니다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># vagrant ssh</span>
<span class="nb">sudo </span>docker ps
</code></pre></div></div> <p>또한, 로컬 머신(host system)에서 <code class="highlighter-rouge">http://localhost</code>를 실행하여 <code class="highlighter-rouge">nginx</code>의 <code class="highlighter-rouge">404 Not Found</code> 에러 화면이 표시됩니다.</p> <h2 id="완료">완료</h2> <p>앤서블(Ansible)을 통해 라라독(Laradock)을 설치하여 라라벨(Laravel) 개발 환경을 준비하였습니다. 지금은 라라벨(Laravel) 프로젝트가 설정이 되어있지 않아 <code class="highlighter-rouge">404 Not Found</code> 화면이 보이지만, 개발 환경은 성공적으로 설정하였습니다. 다음 시간에는 라라독(Laradock) 개발 환경에 라라벨(Laravel) 프로젝트를 설정해 보도록 하겠습니다.</p> <h2 id="참고">참고</h2> <ul> <li><a href="https://laradock.io/documentation/" rel="nofollow noreferrer" target="_blank">https://laradock.io/documentation/</a></li> </ul> <div class="buy_me_a_coffee_container"> <style> .bmc-button img { width: 27px !important; margin-bottom: 1px !important; box-shadow: none !important; border: none !important; vertical-align: middle !important; } .bmc-button { line-height: 36px !important; height: 37px !important; text-decoration: none !important; display: inline-flex !important; color: #ffffff !important; background-color: #ff813f !important; border-radius: 3px !important; border: 1px solid transparent !important; padding: 0px 9px !important; font-size: 17px !important; letter-spacing: -0.08px !important; box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important; -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important; margin: 0 auto !important; font-family: 'Lato', sans-serif !important; -webkit-box-sizing: border-box !important; box-sizing: border-box !important; -o-transition: 0.3s all linear !important; -webkit-transition: 0.3s all linear !important; -moz-transition: 0.3s all linear !important; -ms-transition: 0.3s all linear !important; transition: 0.3s all linear !important; } .bmc-button:hover, .bmc-button:active, .bmc-button:focus { -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important; text-decoration: none !important; box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important; opacity: 0.85 !important; color: #ffffff !important; }</style><link href="https://fonts.googleapis.com/css?family=Lato&subset=latin,latin-ext" rel="stylesheet"/><a class="bmc-button" target="_blank" href="https://www.buymeacoffee.com/j0cXhWiza" rel="noopener noreferrer nofollow"><img src="https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg" alt="Buy me a coffee"/><span style="margin-left:5px">Buy me a coffee</span></a> </div> </article> <div class="col-lg-2 col-md-1 d-none d-lg-block right-ads"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:inline-block;width:120px;height:600px" data-ad-client="ca-pub-7987914246691031" data-ad-slot="9858937018"></ins> <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script> </div> </div> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7987914246691031" data-ad-slot="1936214968" data-ad-format="auto" data-full-width-responsive="true"></ins> <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script> <div class="row"> <div class="col-lg-8 col-md-10 mx-auto"> <div class="post-list-container"> <div class="header"> <div class="header-title">Posts</div> </div> <div class="body"> <div class="list-group"></div> </div> <div class="footer"> <ul class="pagination"> <li class="page-item page-item--previous"> <div class="page-link" aria-label="Previous"> <span aria-hidden="true">&laquo;</span> <span class="sr-only">Previous</span> </div> </li> <li class="page-item page-item--next"> <div class="page-link" aria-label="Next"> <span aria-hidden="true">&raquo;</span> <span class="sr-only">Next</span> </div> </li> </ul> </div> </div> <script type="text/javascript">document.addEventListener("DOMContentLoaded",function(){$.get("/ko/api/environment/posts.json",function(e){e.length>0&&($(".post-list-container").show(),e.forEach(function(e){var a=$(".post-list-container .body .list-group"),t=a.find(".page-"+e.page),i=e.url.indexOf(location.pathname)>=0?"active":"",s="";if(s+='<a href="'+e.url+'" class="list-group-item list-group-item-action flex-column align-items-start '+i+'">',s+='  <div class="d-flex w-100 justify-content-between">',s+='    <div class="mb-1">'+e.title+"</div>",s+="  </div>",s+='  <div class="body-text">'+e.description+"</div>",s+="</a>",t.length>0)t.addClass(i),t.append(s);else{var n="";n+='<div class="page page-'+e.page+" "+i+'">',n+=s,n+="</div>",a.append(n)}var p="";p+='<li class="page-item page-item--link '+i+'" data-page="'+e.page+'">',p+='  <div class="page-link" data-page="'+e.page+'">',p+=e.page,p+="  </div>",p+="</li>",0===$('.post-list-container .footer .page-item[data-page="'+e.page+'"]').length&&$(".post-list-container .footer .page-item--next").before(p),"active"===i&&$("li[data-page="+e.page+"]").addClass(i),e.page>1&&$(".footer").css("display","flex")}))}),$("body").on("click",".page-link",function(){var e=$(".post-list-container .body .list-group"),a=$(".footer .pagination"),t=a.find(".page-item.active"),i=t.find(".page-link").data("page"),s=$(this).data("page");if($(this).closest(".page-item").hasClass("page-item--previous"))s=i>1?i-1:1;else if($(this).closest(".page-item").hasClass("page-item--next")){var n=a.find(".page-item--link").length;s=i<n?i+1:n}else var s=$(this).data("page");e.find(".page").removeClass("active"),e.find(".page-"+s).addClass("active"),a.find(".page-item").removeClass("active"),a.find('.page-link[data-page="'+s+'"]').closest(".page-item").addClass("active")})});</script> </div> <div class="col-lg-8 col-md-10 mx-auto"> <hr/> <div id="disqus_thread"></div> <script>var disqus_config=function(){this.page.url="https://dev-yakuza.github.io/environment/ansible-laradock/",this.page.identifier="https://dev-yakuza.github.io/environment/ansible-laradock/"};!function(){var t=document,e=t.createElement("script");e.src="https://https-dev-yakuza-github-io-ko.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}();</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> </div> </div> </div> </div> <hr/> <footer> <div class="container"> <div class="row"> <div class="col-lg-8 col-md-10 mx-auto share-title"> SHARE </div> <div class="col-lg-8 col-md-10 mx-auto"> <ul class="list-inline text-center"> <li class="list-inline-item"> <a href="https://twitter.com/intent/tweet?text=앤서블&라라독&url=https://dev-yakuza.github.io/environment/ansible-laradock/" rel="nofollow noreferrer noopener" target="_blank"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-twitter fa-stack-1x fa-inverse"></i> </span> </a> </li> <li class="list-inline-item"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://dev-yakuza.github.io/environment/ansible-laradock/" rel="nofollow noreferrer noopener" target="_blank"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-facebook fa-stack-1x fa-inverse"></i> </span> </a> </li> <li class="list-inline-item"> <a href="https://dev-yakuza.github.io/ko/feed.xml" rel="nofollow noreferrer noopener" target="_blank"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-rss-square fa-stack-1x fa-inverse" aria-hidden="true"></i> </span> </a> </li> </ul> <p class="copyright text-muted"> Copyright &copy; dev.yakuza@gmail.com 2019 </p> </div> </div> </div> </footer> <script src="/assets/vendor/jquery/jquery.min.js"></script> <script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script> <script src="/assets/vendor/startbootstrap-clean-blog/js/clean-blog.min.js"></script> <script src="/assets/scripts.js"></script> </body> </html>